,
        {
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "name": "[concat(variables('vmNamePrefix'),'0/sqlConfig')]",
            "apiVersion": "2015-06-15",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "virtualMachineLoop",
                "virtualMachineExtensionLoop",
                "clusterIpLoop",
                "agListenerIpLoop",
                "[resourceId('Microsoft.Storage/storageAccounts', variables('witnessStorageName'))]"
            ],
            "properties": {
                "publisher": "Microsoft.Powershell",
                "type": "DSC",
                "typeHandlerVersion": "2.20",
                "autoUpgradeMinorVersion": true,
                "settings": {
                    "modulesUrl": "[variables('sqlConfigModulesURL')]",
                    "configurationFunction": "[variables('sqlConfigFunction')]",
                    "properties": {
                        "domainName": "[parameters('domainName')]",
                        "clusterName": "[variables('clusterName')]",
                        "vmNamePrefix": "[variables('vmNamePrefix')]",
                        "sqlAlwaysOnAvailabilityGroupName": "[variables('agName')]",
                        "sqlAlwaysOnAvailabilityGroupListenerName": "[variables('agListenerName')]",
                        "sqlAlwaysOnAvailabilityGroupListenerPort": 1433,
                        "sqlAlwaysOnEndpointName": "[variables('agEpName')]",
                        "vmCount": "[variables('vmCount')]",
                        "clusterIpAddresses": "[reference(concat(variables('vmNamePrefix'),sub(variables('vmCount'),1),'-clusterIp')).outputs.result.value]",
                        "agListernerIpAddresses": "[reference(concat(variables('vmNamePrefix'),sub(variables('vmCount'),1),'-agListenerIp')).outputs.result.value]",
                        "numberOfDisks": "[parameters('vmDiskCount')]",
                        "workloadType": "[parameters('workloadType')]",
                        "witnessStorageName": "[variables('witnessStorageName')]",
                        "witnessStorageKey": {
                            "userName": "PLACEHOLDER-DO-NOT-USE",
                            "password": "PrivateSettingsRef:witnessStorageKey"
                        },
                        "adminCreds": {
                            "userName": "[parameters('adminUserName')]",
                            "password": "PrivateSettingsRef:adminPassword"
                        },
                        "sqlServiceCreds": {
                            "userName": "[parameters('sqlServiceAccount')]",
                            "password": "PrivateSettingsRef:sqlServicePassword"
                        }
                    }
                },
                "protectedSettings": {
                    "items": {
                        "adminPassword": "[parameters('adminPassword')]",
                        "sqlServicePassword": "[parameters('sqlServicePassword')]",
                        "witnessStorageKey": "[listKeys(resourceId('Microsoft.Storage/storageAccounts',variables('witnessStorageName')),variables('apiVersionStorage')).keys[0].value]"
                    }
                }
            }
        }